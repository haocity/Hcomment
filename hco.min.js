"use strict";function Hco(e,t,i){function a(t){return e.querySelector(t)}var l=document.createElement("div");this.ele=l,this.cid=t+"_"+i,l.className="ew-comment",l.innerHTML='<div class="ew-publish"><div class="ew-publish-title">正在回复 <span class="ew-publish-title-lc">#0</span> <span class="ew-publish-back">返回评论</span></div><div class="ew-textarea-warp"><textarea node-type="textarea" name="" class="ew-textarea" placeholder="评论.." autocomplete="off" spellcheck="false"></textarea></div><div class="ew-info"><input class="text-block ew-author"  name="author" type="text" value="" size="30" placeholder="昵称 *" autocomplete="off">\n\t\t\t\t\t\t<input class="text-block ew-email"  name="email" type="email" value="" size="30" placeholder="邮箱 *" autocomplete="off"><input class="text-block ew-weburl"  name="url" type="url" value="" size="30" placeholder="网址" autocomplete="off"><div class="ew-send-btn">发送</div></div></div><div class="ew-bar">喵喵</div><div class="ew-list"></div>',"string"==typeof e&&(e=document.querySelector(e)),e.appendChild(l);var n=this;this.$c=a;new Object;if(this.now="father",this.id=this.cid,this.api="https://t5.haotown.cn/hcon",this.publish=a(".ew-publish"),localStorage.getItem("ew")){console.log("加载设置成功");var r=JSON.parse(localStorage.getItem("ew"));a(".ew-email").value=r.email,a(".ew-author").value=r.user,a(".ew-weburl").value=r.weburl}a(".ew-textarea").addEventListener("keydown",function(e){13==e.keyCode&&e.ctrlKey&&a(".ew-send-btn").click()},!1),a(".ew-send-btn").addEventListener("click",function(){n.submitfun()},!1),a(".ew-publish-back").addEventListener("click",function(){n.now="father",n.publish.className="ew-publish";for(var e=document.querySelectorAll(".ew-li-main"),t=0;t<e.length;t++)e[t].style.marginBottom&&(e[t].style.marginBottom="auto")},!1),n.update()}function rhex(e){for(str="",j=0;j<=3;j++)str+=hex_chr.charAt(e>>8*j+4&15)+hex_chr.charAt(e>>8*j&15);return str}function str2blks_MD5(e){for(nblk=1+(e.length+8>>6),blks=new Array(16*nblk),i=0;i<16*nblk;i++)blks[i]=0;for(i=0;i<e.length;i++)blks[i>>2]|=e.charCodeAt(i)<<i%4*8;return blks[i>>2]|=128<<i%4*8,blks[16*nblk-2]=8*e.length,blks}function add(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function rol(e,t){return e<<t|e>>>32-t}function cmn(e,t,i,a,l,n){return add(rol(add(add(t,e),add(a,n)),l),i)}function ff(e,t,i,a,l,n,r){return cmn(t&i|~t&a,e,t,l,n,r)}function gg(e,t,i,a,l,n,r){return cmn(t&a|i&~a,e,t,l,n,r)}function hh(e,t,i,a,l,n,r){return cmn(t^i^a,e,t,l,n,r)}function ii(e,t,i,a,l,n,r){return cmn(i^(t|~a),e,t,l,n,r)}function MD5(e){x=str2blks_MD5(e);var t=1732584193,a=-271733879,l=-1732584194,n=271733878;for(i=0;i<x.length;i+=16){var r=t,o=a,s=l,c=n;t=ff(t,a,l,n,x[i+0],7,-680876936),n=ff(n,t,a,l,x[i+1],12,-389564586),l=ff(l,n,t,a,x[i+2],17,606105819),a=ff(a,l,n,t,x[i+3],22,-1044525330),t=ff(t,a,l,n,x[i+4],7,-176418897),n=ff(n,t,a,l,x[i+5],12,1200080426),l=ff(l,n,t,a,x[i+6],17,-1473231341),a=ff(a,l,n,t,x[i+7],22,-45705983),t=ff(t,a,l,n,x[i+8],7,1770035416),n=ff(n,t,a,l,x[i+9],12,-1958414417),l=ff(l,n,t,a,x[i+10],17,-42063),a=ff(a,l,n,t,x[i+11],22,-1990404162),t=ff(t,a,l,n,x[i+12],7,1804603682),n=ff(n,t,a,l,x[i+13],12,-40341101),l=ff(l,n,t,a,x[i+14],17,-1502002290),a=ff(a,l,n,t,x[i+15],22,1236535329),t=gg(t,a,l,n,x[i+1],5,-165796510),n=gg(n,t,a,l,x[i+6],9,-1069501632),l=gg(l,n,t,a,x[i+11],14,643717713),a=gg(a,l,n,t,x[i+0],20,-373897302),t=gg(t,a,l,n,x[i+5],5,-701558691),n=gg(n,t,a,l,x[i+10],9,38016083),l=gg(l,n,t,a,x[i+15],14,-660478335),a=gg(a,l,n,t,x[i+4],20,-405537848),t=gg(t,a,l,n,x[i+9],5,568446438),n=gg(n,t,a,l,x[i+14],9,-1019803690),l=gg(l,n,t,a,x[i+3],14,-187363961),a=gg(a,l,n,t,x[i+8],20,1163531501),t=gg(t,a,l,n,x[i+13],5,-1444681467),n=gg(n,t,a,l,x[i+2],9,-51403784),l=gg(l,n,t,a,x[i+7],14,1735328473),a=gg(a,l,n,t,x[i+12],20,-1926607734),t=hh(t,a,l,n,x[i+5],4,-378558),n=hh(n,t,a,l,x[i+8],11,-2022574463),l=hh(l,n,t,a,x[i+11],16,1839030562),a=hh(a,l,n,t,x[i+14],23,-35309556),t=hh(t,a,l,n,x[i+1],4,-1530992060),n=hh(n,t,a,l,x[i+4],11,1272893353),l=hh(l,n,t,a,x[i+7],16,-155497632),a=hh(a,l,n,t,x[i+10],23,-1094730640),t=hh(t,a,l,n,x[i+13],4,681279174),n=hh(n,t,a,l,x[i+0],11,-358537222),l=hh(l,n,t,a,x[i+3],16,-722521979),a=hh(a,l,n,t,x[i+6],23,76029189),t=hh(t,a,l,n,x[i+9],4,-640364487),n=hh(n,t,a,l,x[i+12],11,-421815835),l=hh(l,n,t,a,x[i+15],16,530742520),a=hh(a,l,n,t,x[i+2],23,-995338651),t=ii(t,a,l,n,x[i+0],6,-198630844),n=ii(n,t,a,l,x[i+7],10,1126891415),l=ii(l,n,t,a,x[i+14],15,-1416354905),a=ii(a,l,n,t,x[i+5],21,-57434055),t=ii(t,a,l,n,x[i+12],6,1700485571),n=ii(n,t,a,l,x[i+3],10,-1894986606),l=ii(l,n,t,a,x[i+10],15,-1051523),a=ii(a,l,n,t,x[i+1],21,-2054922799),t=ii(t,a,l,n,x[i+8],6,1873313359),n=ii(n,t,a,l,x[i+15],10,-30611744),l=ii(l,n,t,a,x[i+6],15,-1560198380),a=ii(a,l,n,t,x[i+13],21,1309151649),t=ii(t,a,l,n,x[i+4],6,-145523070),n=ii(n,t,a,l,x[i+11],10,-1120210379),l=ii(l,n,t,a,x[i+2],15,718787259),a=ii(a,l,n,t,x[i+9],21,-343485551),t=add(t,r),a=add(a,o),l=add(l,s),n=add(n,c)}return rhex(t)+rhex(a)+rhex(l)+rhex(n)}var e=document.createElement("style");e.innerHTML="body{background-color:#EEE}.ew-comment{padding:15px 10px;position:relative}.comment{width:800px;margin:0 auto}.ew-publish{overflow:hidden}.ew-publish-fly{position:absolute;top:256px;width:100%;left:0}.ew-publish-title{font-size:16px;padding:10px 0;font-weight:500;color:#565656}.ew-publish-title-lc{color:#969292;display:none}.ew-publish-back{color:#e07e7e;display:none;cursor:pointer;margin-left:30px}.ew-publish-fly .ew-publish-back,.ew-publish-fly .ew-publish-title-lc{display:inline-block}.ew-textarea-warp{background-color:#fff;border-radius:12px;padding:6px;border:1px solid #d0d0d0}.ew-textarea{width:100%;height:70px;background:0;overflow-x:hidden;overflow-y:auto;border:0;font-size:14px;color:#333;resize:none;line-height:normal;text-align:left;outline:medium}.ew-info{margin-top:20px;margin-bottom:10px;position:relative}.ew-info>.text-block{height:25px;width:24%;margin-right:2%;border:1px solid #b5b5b5;border-radius:4px;padding:0 4px;outline:0}.ew-info>.ew-send-btn{position:absolute;right:0;top:-4px;width:130px;background-color:#e88678;color:#fff;text-align:center;line-height:40px;font-size:20px;border-radius:10px;box-shadow:0 0 10px rgba(253,0,0,0.4);cursor:pointer}.ew-bar{background-color:#b5b5b5;color:#fff;margin-top:10px;margin-bottom:10px;font-size:15px;line-height:32px;padding:0 17px}.ew-li{overflow:hidden}.ew-li-main{overflow:hidden;border-left:7px solid #fb9b79;margin-bottom:4px}.ew-li-com-w>.ew-li-com{margin-left:90px}.ew-li-com-w>.ew-li-user,.ew-li-com-w>.ew-li-time{display:inline-block;color:#3a3a3a;font-size:15px;margin-top:12px}.ew-li-user>a{color:#3a3a3a;font-size:15px;text-decoration:none}.ew-li-time{color:#797878;margin-left:10px}.ew-li-main>.ew-li-logo{margin:16px 20px 16px 10px;background-image:url(https://0d077ef9e74d8.cdn.sohucs.com/clip_picture_1486299863299);width:60px;height:60px;background-size:cover;border-radius:50%;float:left}.ew-li-reply{float:right;color:#e88678;cursor:pointer}.ew-li-next{margin-left:50px}.ew-alert{position:fixed;width:300px;height:80px;background-color:rgba(51,51,51,0.56);left:0;right:0;top:0;bottom:0;margin:auto;line-height:80px;z-index:999;color:#fff;text-align:center;font-size:25px;animation:.8s tada}@keyframes tada{from{transform:scale3d(1,1,1)}10%,20%{transform:scale3d(.9,.9,.9) rotate3d(0,0,1,-3deg)}30%,50%,70%,90%{transform:scale3d(1.1,1.1,1.1) rotate3d(0,0,1,3deg)}40%,60%,80%{transform:scale3d(1.1,1.1,1.1) rotate3d(0,0,1,-3deg)}to{transform:scale3d(1,1,1)}}",document.body.appendChild(e),Hco.prototype.alert=function(e){var t=document.createElement("div");t.className="ew-alert",t.innerText=e,document.body.appendChild(t),setTimeout(function(){t.style.display="none",t.remove()},1900)},Hco.prototype.getfloor=function(e){for(var t="#",i=e.toString(),a=i.split("-"),l=0;l<a.length;l++)if(l==a.length-1){var n=parseInt(a[l])+1;t+=n}else t=t+(parseInt(a[l])+1)+"-";return t},Hco.prototype.gettime=function(e){var t=void 0,i=(new Date).getTime(),a=i-e;if(a<6e4)t="刚刚";else if(a<36e5)t=new Date(a).getMinutes()+"分钟前";else if(a<864e5)t=new Date(a).getHours()+"小时前";else{var l=new Date(parseInt(e));t=l.getFullYear()+"年"+l.getMonth()+"月"+l.getDay()+"日"}return t},Hco.prototype.update=function(e){var t=this,i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var a=JSON.parse(i.responseText);t.$c(".ew-list").innerHTML="";for(var l=0;l<a.data.length;l++){var n=a.data[l];t.sendcom(n.cid,n.user,n.email,n.weburl,n.time,n.text)}"father"!=e&&void 0!=e&&t.$c(".ew-id-"+e+">.ew-li-main>.ew-li-com-w>.ew-li-reply")&&t.$c(".ew-id-"+e+">.ew-li-main>.ew-li-com-w>.ew-li-reply").click()}},i.open("GET",this.api+"/get/?id="+this.cid,!0),i.send()},Hco.prototype.sendcom=function(e,t,i,a,l,n){var r=this,o=document.createElement("div"),s=void 0;"father"==e?(s=r.$c(".ew-list").querySelectorAll(".ew-li"),o.className="ew-li ew-id-"+s.length):r.$c(".ew-id-"+e)?(s=r.$c(".ew-id-"+e).querySelectorAll(".ew-li"),o.className="ew-li ew-id-"+e+"-"+s.length):console.log("数据可能存在错误");var c='<div class="ew-li-main"><div class="ew-li-logo" style="background-image:url(https://v2ex.assets.uxengine.net/gravatar/'+MD5(i)+'?s=80&d=retro)"></div><div class="ew-li-com-w"><div class="ew-li-user"><a href="'+a+'" target="_blank">'+t+'</a></div><div class="ew-li-time">'+r.gettime(l)+'</div><pre class="ew-li-com">'+n+'</pre></div></div><div class="ew-li-next"></div></div>';o.innerHTML=c,o.m=i;var d=document.createElement("div");d.className="ew-li-reply",d.innerHTML="回复",d.addEventListener("click",function(){r.now=this.i;for(var e=document.querySelectorAll(".ew-li-main"),t=0;t<e.length;t++)e[t].style.marginBottom&&(e[t].style.marginBottom="auto");var i=o.querySelector(".ew-li-main");r.publish.className="ew-publish ew-publish-fly",r.publish.style.top=i.offsetHeight+i.offsetTop+"px",i.style.marginBottom="250px",r.$c(".ew-publish-title-lc").innerHTML=r.getfloor(this.i)},!1),o.querySelector(".ew-li-main>.ew-li-com-w").appendChild(d),"father"==e?(d.i=s.length,r.$c(".ew-list").appendChild(o)):r.$c(".ew-id-"+e+">.ew-li-next")?(d.i=e+"-"+s.length,r.$c(".ew-id-"+e+">.ew-li-next").appendChild(o)):console.log("数据可能存在错误"+e)},Hco.prototype.submitfun=function(){var e=this,t=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(e.$c(".ew-textarea").value.length<=6)e.alert("内容太短了");else if(e.$c(".ew-author").value)if(t.test(e.$c(".ew-email").value)){for(var i=(new Date,[/\n/g,/<script/g,/<\/script/g,/<style/g,/<\/style/g,/<\/div/g,/<div/g,/<\/pre/g,/<[a-z]+\s+on[a-z]+\s+?=/g]),a=0;a<i.length;a++)var l=e.$c(".ew-textarea").value.replace(i[a],"<br>");var n="";"father"!=e.now&&(n=this.$c(".ew-id-"+this.now).m);var r={id:e.id,user:e.$c(".ew-author").value,email:e.$c(".ew-email").value,weburl:e.$c(".ew-weburl").value,text:l,cid:e.now,url:document.location.href,title:document.title,pm:n};r=function(e){var t="";for(var i in e)t+=i+"="+e[i]+"&";return t}(r);var o=new XMLHttpRequest;o.open("POST",e.api+"/send/",!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){var t=o;if(4==t.readyState&&200==t.status){if(JSON.parse(t.responseText).success){e.update(e.now),e.alert("评论成功"),e.$c(".ew-textarea").value="";var i='{"user":"'+e.$c(".ew-author").value+'","email":"'+e.$c(".ew-email").value+'","weburl":"'+e.$c(".ew-weburl").value+'"}';localStorage.setItem("ew",i)}else e.alert("发送失败")}},o.send(r)}else e.alert("邮箱错误");else e.alert("请输入用户名")};var hex_chr="0123456789abcdef";