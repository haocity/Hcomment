"use strict";function Hco(e,t,i){function a(t){return e.querySelector(t)}var l=document.createElement("div");this.ele=l,this.cid=t+"_"+i,l.className="ew-comment",l.innerHTML='<div class="ew-publish">\n\t\t\t\t<div class="ew-publish-title">正在回复 <span class="ew-publish-title-lc">#0</span> <span class="ew-publish-back">返回评论</span></div>\n\t\t\t\t\t<div class="ew-textarea-warp">\n\t\t\t\t\t\t<textarea node-type="textarea" name="" class="ew-textarea" placeholder="评论.." autocomplete="off" spellcheck="false"></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ew-info">\n\t\t\t\t\t\t<input class="text-block ew-author"  name="author" type="text" value="" size="30" placeholder="昵称 *" autocomplete="off">\n\t\t\t\t\t\t<input class="text-block ew-email"  name="email" type="email" value="" size="30" placeholder="邮箱 *" autocomplete="off">\n\t\t\t\t\t\t<input class="text-block ew-weburl"  name="url" type="url" value="" size="30" placeholder="网址" autocomplete="off">\n\t\t\t\t\t\t<div class="ew-send-btn">发送</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ew-bar">喵喵</div>\n\t\t\t\t<div class="ew-list">\n\t\t\t\t</div>',"string"==typeof e&&(e=document.querySelector(e)),e.appendChild(l);var o=this;this.$c=a;new Object;if(this.now="father",this.id=this.cid,this.api="https://t5.haotown.cn/hcon",this.publish=a(".ew-publish"),localStorage.getItem("ew")){console.log("加载设置成功");var n=JSON.parse(localStorage.getItem("ew"));a(".ew-email").value=n.email,a(".ew-author").value=n.user,a(".ew-weburl").value=n.weburl}a(".ew-textarea").addEventListener("keydown",function(e){13==e.keyCode&&e.ctrlKey&&a(".ew-send-btn").click()},!1),a(".ew-send-btn").addEventListener("click",function(){o.submitfun()},!1),a(".ew-publish-back").addEventListener("click",function(){o.now="father",o.publish.className="ew-publish";for(var e=document.querySelectorAll(".ew-li-main"),t=0;t<e.length;t++)e[t].style.marginBottom&&(e[t].style.marginBottom="auto")},!1),o.update()}var e=document.createElement("style");e.innerHTML="body{background-color:#EEE}.ew-comment{padding:15px 10px;position:relative}.comment{width:800px;margin:0 auto}.ew-publish{overflow:hidden}.ew-publish-fly{position:absolute;top:256px;width:100%;left:0}.ew-publish-title{font-size:16px;padding:10px 0;font-weight:500;color:#565656}.ew-publish-title-lc{color:#969292;display:none}.ew-publish-back{color:#e07e7e;display:none;cursor:pointer;margin-left:30px}.ew-publish-fly .ew-publish-back,.ew-publish-fly .ew-publish-title-lc{display:inline-block}.ew-textarea-warp{background-color:#fff;border-radius:12px;padding:6px;border:1px solid #d0d0d0}.ew-textarea{width:100%;height:70px;background:0;overflow-x:hidden;overflow-y:auto;border:0;font-size:14px;color:#333;resize:none;line-height:normal;text-align:left;outline:medium}.ew-info{margin-top:20px;margin-bottom:10px;position:relative}.ew-info>.text-block{height:25px;width:24%;margin-right:2%;border:1px solid #b5b5b5;border-radius:4px;padding:0 4px;outline:0}.ew-info>.ew-send-btn{position:absolute;right:0;top:-4px;width:130px;background-color:#e88678;color:#fff;text-align:center;line-height:40px;font-size:20px;border-radius:10px;box-shadow:0 0 10px rgba(253,0,0,0.4);cursor:pointer}.ew-bar{background-color:#b5b5b5;color:#fff;margin-top:10px;margin-bottom:10px;font-size:15px;line-height:32px;padding:0 17px}.ew-li{overflow:hidden}.ew-li-main{overflow:hidden;border-left:7px solid #fb9b79;margin-bottom:4px}.ew-li-com-w>.ew-li-com{margin-left:90px}.ew-li-com-w>.ew-li-user,.ew-li-com-w>.ew-li-time{display:inline-block;color:#3a3a3a;font-size:15px;margin-top:12px}.ew-li-user>a{color:#3a3a3a;font-size:15px;text-decoration:none}.ew-li-time{color:#797878;margin-left:10px}.ew-li-main>.ew-li-logo{margin:16px 20px 16px 10px;background-image:url(https://0d077ef9e74d8.cdn.sohucs.com/clip_picture_1486299863299);width:60px;height:60px;background-size:cover;border-radius:50%;float:left}.ew-li-reply{float:right;color:#e88678;cursor:pointer}.ew-li-next{margin-left:50px}.ew-alert{position:fixed;width:300px;height:80px;background-color:rgba(51,51,51,0.56);left:0;right:0;top:0;bottom:0;margin:auto;line-height:80px;z-index:999;color:#fff;text-align:center;font-size:25px;animation:.8s tada}@keyframes tada{from{transform:scale3d(1,1,1)}10%,20%{transform:scale3d(.9,.9,.9) rotate3d(0,0,1,-3deg)}30%,50%,70%,90%{transform:scale3d(1.1,1.1,1.1) rotate3d(0,0,1,3deg)}40%,60%,80%{transform:scale3d(1.1,1.1,1.1) rotate3d(0,0,1,-3deg)}to{transform:scale3d(1,1,1)}}",document.body.appendChild(e),Hco.prototype.alert=function(e){var t=document.createElement("div");t.className="ew-alert",t.innerText=e,document.body.appendChild(t),setTimeout(function(){t.style.display="none",t.remove()},1900)},Hco.prototype.getfloor=function(e){for(var t="#",i=e.toString(),a=i.split("-"),l=0;l<a.length;l++)if(l==a.length-1){var o=parseInt(a[l])+1;t+=o}else t=t+(parseInt(a[l])+1)+"-";return t},Hco.prototype.gettime=function(e){var t=void 0,i=(new Date).getTime(),a=i-e;if(a<6e4)t="刚刚";else if(a<36e5)t=new Date(a).getMinutes()+"分钟前";else if(a<864e5)t=new Date(a).getHours()+"小时前";else{var l=new Date(parseInt(e));t=l.getFullYear()+"年"+l.getMonth()+"月"+l.getDay()+"日"}return t},Hco.prototype.update=function(e){var t=this,i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var a=JSON.parse(i.responseText);t.$c(".ew-list").innerHTML="";for(var l=0;l<a.data.length;l++){var o=a.data[l];t.sendcom(o.cid,o.user,o.email,o.weburl,o.time,o.text)}"father"!=e&&void 0!=e&&t.$c(".ew-id-"+e+">.ew-li-main>.ew-li-com-w>.ew-li-reply")&&t.$c(".ew-id-"+e+">.ew-li-main>.ew-li-com-w>.ew-li-reply").click()}},i.open("GET",this.api+"/get/?id="+this.cid,!0),i.send()},Hco.prototype.sendcom=function(e,t,i,a,l,o){var n=this,r=document.createElement("div"),s=void 0;"father"==e?(s=n.$c(".ew-list").querySelectorAll(".ew-li"),r.className="ew-li ew-id-"+s.length):n.$c(".ew-id-"+e)?(s=n.$c(".ew-id-"+e).querySelectorAll(".ew-li"),r.className="ew-li ew-id-"+e+"-"+s.length):console.log("数据可能存在错误");var c='<div class="ew-li-main">\n\t\t\t\t\t\t\t<div class="ew-li-logo" style="background-image:url(https://v2ex.assets.uxengine.net/gravatar/'+MD5(i)+'?s=80&d=retro)"></div>\n\t\t\t\t\t\t\t<div class="ew-li-com-w">\n\t\t\t\t\t\t\t\t<div class="ew-li-user"><a href="'+a+'" target="_blank">'+t+'</a></div>\n\t\t\t\t\t\t\t\t<div class="ew-li-time">'+n.gettime(l)+'</div>\n\t\t\t\t\t\t\t\t<pre class="ew-li-com">'+o+'</pre>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ew-li-next"></div>\n\t\t\t\t\t\t</div>';r.innerHTML=c,r.m=i;var d=document.createElement("div");d.className="ew-li-reply",d.innerHTML="回复",d.addEventListener("click",function(){n.now=this.i;for(var e=document.querySelectorAll(".ew-li-main"),t=0;t<e.length;t++)e[t].style.marginBottom&&(e[t].style.marginBottom="auto");var i=r.querySelector(".ew-li-main");n.publish.className="ew-publish ew-publish-fly",n.publish.style.top=i.offsetHeight+i.offsetTop+"px",i.style.marginBottom="250px",n.$c(".ew-publish-title-lc").innerHTML=n.getfloor(this.i)},!1),r.querySelector(".ew-li-main>.ew-li-com-w").appendChild(d),"father"==e?(d.i=s.length,n.$c(".ew-list").appendChild(r)):n.$c(".ew-id-"+e+">.ew-li-next")?(d.i=e+"-"+s.length,n.$c(".ew-id-"+e+">.ew-li-next").appendChild(r)):console.log("数据可能存在错误"+e)},Hco.prototype.submitfun=function(){var e=this,t=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(e.$c(".ew-textarea").value.length<=6)e.alert("内容太短了");else if(e.$c(".ew-author").value)if(t.test(e.$c(".ew-email").value)){for(var i=(new Date,[/\n/g,/<script/g,/<\/script/g,/<style/g,/<\/style/g,/<\/div/g,/<div/g,/<\/pre/g,/<[a-z]+\s+on[a-z]+\s+?=/g]),a=0;a<i.length;a++)var l=e.$c(".ew-textarea").value.replace(i[a],"<br>");var o="";"father"!=e.now&&(o=this.$c(".ew-id-"+this.now).m);var n={id:e.id,user:e.$c(".ew-author").value,email:e.$c(".ew-email").value,weburl:e.$c(".ew-weburl").value,text:l,cid:e.now,url:document.location.href,title:document.title,pm:o};n=function(e){var t="";for(var i in e)t+=i+"="+e[i]+"&";return t}(n);var r=new XMLHttpRequest;r.open("POST",e.api+"/send/",!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){var t=r;if(4==t.readyState&&200==t.status){if(JSON.parse(t.responseText).success){e.update(e.now),e.alert("评论成功"),e.$c(".ew-textarea").value="";var i='{"user":"'+e.$c(".ew-author").value+'","email":"'+e.$c(".ew-email").value+'","weburl":"'+e.$c(".ew-weburl").value+'"}';localStorage.setItem("ew",i)}else e.alert("发送失败")}},r.send(n)}else e.alert("邮箱错误");else e.alert("请输入用户名")};